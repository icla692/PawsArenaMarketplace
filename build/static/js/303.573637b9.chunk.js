"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[303],{8657:(t,e,s)=>{s.d(e,{A:()=>h});var r=s(3747),i=s(7097),n=s(5043),a=s(1935),o=s(2198),u=s(710),c=s(2013),l=s(3216),d=s(579);const h=t=>{let{nftid:e,nft_price:s,userP:h}=t;const[m,p]=(0,n.useState)(!1),[f,x]=(0,n.useState)(!1),[y,b]=(0,n.useState)(""),[g,v]=(0,n.useState)(""),{invalidateListings:j,invalidateUserNfts:N,invalidateUserBalance:w}=(0,c.A)(),I=async(t,e)=>{b(t),v(e),x(!0),setTimeout((()=>x(!1)),3e3)},{data:O}=(0,r.I)({queryKey:["userPrincipal"]}),{data:_}=(0,r.I)({queryKey:["userIcpBalance"]}),{data:K}=(0,r.I)({queryKey:["allListings"]}),{data:M}=(0,r.I)({queryKey:["userNFTS"]}),{data:k}=(0,r.I)({queryKey:["nftActor"]}),{data:C}=(0,r.I)({queryKey:["marketplaceActor"]}),{data:R}=(0,r.I)({queryKey:["IcpActor"]}),q=(0,l.Zp)(),{mutateAsync:E}=(0,i.n)({mutationFn:()=>S(),onSuccess:async()=>{j(),N(),w(),p(!1)}}),S=async()=>{try{if(!C)return alert("Log in first to purchase this NFT"),void I("Log in first to purchase this NFT","error");p(!0);let t=await R.icrc2_approve({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:Number(s)+2e4,expected_allowance:[],expires_at:[],spender:{owner:o.Principal.fromText(a.WC),subaccount:[]}});console.log("approve results :",t);let r=await C.buy_nft(e);200==r.status&&"Ok"==r.status_text?I("NFT purchase successful","success"):I(r.error_text,"error"),console.log("buy results :",r)}catch(t){console.log("error in buying nft :",t)}q("/profile")};return(0,d.jsxs)(d.Fragment,{children:[f&&(0,d.jsx)("div",{className:"absolute top-10 z-50 text-xs  left-1/2 transform -translate-x-1/2 transition-transform duration-500 ease-out "+("success"===g?"bg-green-100 text-green-800 border border-green-300 rounded-lg p-1 animate-slide-in":"bg-red-100 text-red-800 border border-red-300 rounded-lg p-1 animate-slide-in"),children:(0,d.jsx)("div",{className:"modal-message",children:(0,d.jsx)("p",{children:y})})}),(0,d.jsx)("button",{onClick:()=>E(),className:"flex w-full bg-[#2E8DEE] rounded-b-lg mt-4 font-bold text-white justify-center items-center p-2",children:m?(0,d.jsx)(u.A,{size:20,color:"white"}):"Buy"})]})}},1303:(t,e,s)=>{s.r(e),s.d(e,{default:()=>l});var r=s(3248),i=s(3747),n=(s(5043),s(1935),s(8657)),a=s(3216),o=s(579);const u={wrapper:"bg-[#212121] w-[200px] mb-3 rounded-md overflow-hidden group",imgContainer:"h-40 bg-red-400 sm:h-32 md:h-36 w-full bg-[#121212] flex justify-center items-center overflow-hidden",nftImg:"w-[200px] h-48 ml-[3px] mt-[3px] rounded-t-md cursor-pointer object-cover",info:"flex justify-between text-white drop-shadow-xl ml-2 mr-2",infoLeft:"flex-0.6 flex-wrap",collectionName:"font-semibold text-xs sm:text-sm md:text-base lg:text-lg text-white",assetName:"font-bold mt-1",infoRight:"flex-0.4 text-right",priceTag:"font-semibold text-xs sm:text-sm md:text-base lg:text-lg text-white",priceValue:"flex items-center text-lg sm:text-xl md:text-2xl font-bold mt-1",ethLogo:"h-5 mr-2",likes:"text-[#8a939b] font-bold flex items-center w-full justify-end mt-2",likeIcon:"text-xl mr-2",buyButtonContainer:"opacity-0 group-hover:opacity-100 transition-opacity duration-300"},c=t=>{let{nft:e}=t;const{data:s}=(0,i.I)({queryKey:["userPrincipal"]}),r=(0,a.Zp)();return(0,o.jsxs)("div",{className:u.wrapper,children:[(0,o.jsx)("img",{src:`https://${e[1].nft_canister}.raw.icp0.io/?tokenid=${e[1].token_identifier}&type=thumbnail`,alt:"",onClick:()=>r("../marketplace/"+e[1].nft_canister+"/"+e[1].nft_id),className:u.nftImg}),(0,o.jsxs)("div",{className:u.details,children:[(0,o.jsxs)("div",{className:u.info,children:[(0,o.jsxs)("div",{className:u.infoLeft,children:[(0,o.jsx)("div",{className:u.collectionName,children:Object.keys(e[1].nft_category)}),(0,o.jsxs)("div",{className:u.priceTag,children:[Number(e[1].nft_price)/1e8," ICP"]})]}),(0,o.jsx)("div",{className:u.infoRight,children:(0,o.jsxs)("div",{className:u.assetName,children:["#",e[1].nft_id," "]})})]}),(0,o.jsx)("div",{className:u.buyButtonContainer,children:(0,o.jsx)(n.A,{nftid:e[0],nft_price:Number(e[1].nft_price),userP:e[1].seller_principal})})]})]})},l=()=>{const t=(0,a.Zp)(),{data:e}=((0,r.jE)(),(0,i.I)({queryKey:["userPrincipal"]})),{data:s}=(0,i.I)({queryKey:["allListings"]}),{data:n}=(0,i.I)({queryKey:["userIcpBalance"]}),{data:u}=(0,i.I)({queryKey:["marketplaceActor"]}),{data:l}=(0,i.I)({queryKey:["nftActor"]}),{data:d}=(0,i.I)({queryKey:["userAccountId"]});return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:"flex bg-[#121212] flex-col py-2 min-h-screen  items-center w-full",children:e?(0,o.jsx)("div",{className:"flex px-4 flex-wrap justify-center md:justify-start items-center gap-3",children:s&&(null===s||void 0===s?void 0:s.map(((t,e)=>(0,o.jsxs)("div",{className:"",children:[" ",(0,o.jsx)(c,{nft:t,index:e})]},e))))}):t("/")})})}},7097:(t,e,s)=>{s.d(e,{n:()=>d});var r=s(5043),i=s(5239),n=s(1454),a=s(329),o=s(9723),u=class extends a.Q{#t;#e=void 0;#s;#r;constructor(t,e){super(),this.#t=t,this.setOptions(e),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#t.defaultMutationOptions(t),(0,o.f8)(this.options,e)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,o.EN)(e.mutationKey)!==(0,o.EN)(this.options.mutationKey)?this.reset():"pending"===this.#s?.state.status&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#e}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#i(),this.#n()}mutate(t,e){return this.#r=e,this.#s?.removeObserver(this),this.#s=this.#t.getMutationCache().build(this.#t,this.options),this.#s.addObserver(this),this.#s.execute(t)}#i(){const t=this.#s?.state??(0,i.$)();this.#e={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#n(t){n.j.batch((()=>{if(this.#r&&this.hasListeners()){const e=this.#e.variables,s=this.#e.context;"success"===t?.type?(this.#r.onSuccess?.(t.data,e,s),this.#r.onSettled?.(t.data,null,e,s)):"error"===t?.type&&(this.#r.onError?.(t.error,e,s),this.#r.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach((t=>{t(this.#e)}))}))}},c=s(3248),l=s(3247);function d(t,e){const s=(0,c.jE)(e),[i]=r.useState((()=>new u(s,t)));r.useEffect((()=>{i.setOptions(t)}),[i,t]);const a=r.useSyncExternalStore(r.useCallback((t=>i.subscribe(n.j.batchCalls(t))),[i]),(()=>i.getCurrentResult()),(()=>i.getCurrentResult())),o=r.useCallback(((t,e)=>{i.mutate(t,e).catch(l.l)}),[i]);if(a.error&&(0,l.G)(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}}}]);
//# sourceMappingURL=303.573637b9.chunk.js.map